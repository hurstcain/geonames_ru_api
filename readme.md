## API для получения информации о географических объектах

При написании программы использовались следующие библиотеки: socket, json, re, psycopg2.  
В качестве СУБД используется PostgreSQL.

### Как использовать программу

Поиск информации осуществляется двумя способами: по всей базе и по конкретному виду географических объектов.  

Виды географических объектов и их коды:  
**A** - страна, область  
**H** - водоемы  
**L** - парки, различные районы и т.д.  
**P** - города, поселения  
**R** - дороги  
**S** - здания, фермы и т.д.  
**T** - горы, возвышенности, острова и т.д.  
**U** - подводный мир  
**V** - леса, пустоши и т.д.  
Подробнее можно посмотреть [здесь](http://www.geonames.org/export/codes.html).

Чтобы производить поиск по конкретному виду, следует в запросе указать код нужного вида географического объекта.  
Пример: http://127.0.0.1:8000/code/r/all  
Данный запрос вернет список всех дорог из базы.

![](imgs/2.png)

### Подробнее про возвращаемые поля

*geonameid* - id географического объекта  
*name* - название объекта  
*asciiname* - название объекта, состоящее из ascii символов  
*alternatenames* - альтернативные названия объекта  
*latitude* - широта  
*longitude* - долгота  
*feature class* - вид или класс объекта, о них было написано выше  
*feature code* - код объекта (подробнее [здесь](https://download.geonames.org/export/dump/featureCodes_ru.txt))  
*country code* - код страны  
*cc2* - альтернативный код страны  
*admin1 code* - код административного центра объекта (перечень находится [здесь](https://download.geonames.org/export/dump/admin1CodesASCII.txt))  
*admin2 code* - код района (перечень можно посмотреть [здесь](https://download.geonames.org/export/dump/admin2Codes.txt))  
*admin3 code* - код административного подразделения третьего уровня  
*admin4 code* - код административного подразделения четвертого уровня  
*population* - население  
*elevation* - высота объекта  
*dem* - цифровая модель рельефа, srtm3 или gtopo30, средняя высота территории 3''x3'' (около 90мx90м) или 30''x30'' (около 900мx900м) в метрах  
*timezone* - часовой пояс  
*modification date* - дата последнего изменения

### Перечень возможных запросов

#### 1) Поиск по id географического объекта

*Примеры запросов:*  
http://127.0.0.1:8000/id/498817  
http://127.0.0.1:8000/id/797730

Возвращает информацию о конкретном географическом объекте по id. Не работает с указанием кода.

![](imgs/1.png)

#### 2) Поиск по названию

*Примеры запросов:*  
http://127.0.0.1:8000/name/москва  
http://127.0.0.1:8000/name/Сочи  
http://127.0.0.1:8000/code/h/name/москва
http://127.0.0.1:8000/code/p/name/Saint%20Petersburg

Возвращает список объектов, название которых совпадает с введенным. Запрос работает с указанием кода объектов.  

![](imgs/3.png)

#### 3) Получить список всех географических объектов

*Примеры запросов:*  
http://127.0.0.1:8000/all  
http://127.0.0.1:8000/code/l/all

Возвращает список всех объектов, которые есть в базе. Запрос работает с указанием кода объектов. В этом случае возвращаются все объекты с указанным кодом.  

![](imgs/4.png)

#### 4) Получить информацию об определенном количестве объектов

*Примеры запросов:*  
http://127.0.0.1:8000/all/5  
http://127.0.0.1:8000/code/t/all/4

Возвращает список первых n объектов, которые есть в базе. Запрос работает с указанием кода объектов. В этом случае возвращается указанное количество объектов с нужным кодом.  

![](imgs/5.png)

#### 5) Различия между объектами

*Примеры запросов:*  
http://127.0.0.1:8000/compare/id?object1=522422&object2=2114529  
http://127.0.0.1:8000/compare/id?object1=524901&object2=498817  

Возвращает информацию о двух объектах и о различиях между ними (какой севернее и разность их часовых поясов). Для получения информации надо указать id географических объектов. Запрос не работает с указанием кода.  

![](imgs/6.png)

#### 6) Получение подсказок

*Примеры запросов:*  
http://127.0.0.1:8000/tips/море  
http://127.0.0.1:8000/code/v/tips/лесо

Чтобы получить подсказку, нужно ввести часть названия объекта. Тогда программа вернет список из геогафических объектов, которые в названии содержат указанное слово. Запрос работает с указанием кода объектов.

![](imgs/7.png)

### Запуск скрипта

Чтобы успешно запустить программу, нужно установить библиотеку psycopg2 для работы с PostgreSQL базами данных.

```
pip install psycopg2
```

Далее нужно создать базу данных или в уже существующую импортировать таблицу с данными, то есть файл db.  

Затем создать файл db_config.py и прописать там следующие строковые переменные:  
*dbname* - название БД  
*user* - имя пользователя БД  
*password* - пароль для доступа к БД  
*host* - хост, на котором работает БД  

Далее можно копировать репозиторий и запускать скрипт.

```
git clone https://github.com/hurstcain/geonames_ru_api
```
```
cd geonames_ru_api
```
```
python script.py
```